{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { createCanvas, loadImage } from \"canvas\";\nimport { mapGetters } from \"vuex\";\nimport His from \"./HistoryBox.vue\";\nimport Group from \"./GroupInfo.vue\";\nexport default {\n  components: {\n    His,\n    Group\n  },\n  computed: {\n    ...mapGetters({\n      GetUser: \"getUser\"\n    })\n  },\n  mounted() {\n    this.loadImageAsBase64(\"Images/noImg.png\");\n    setTimeout(() => {\n      this.Avatar = sessionStorage.getItem(\"Avatar\");\n      this.GetChatGroupList();\n      this.GetAllEMP();\n    }, 500);\n  },\n  methods: {\n    LastMSGUpdate(msgInfo) {\n      this.GroupList.find(grp => grp.GROUP_ID == msgInfo.group_id).INFO.LAST_MSG = msgInfo.msg;\n    },\n    async GroupNameEdit() {\n      await this.axios.post(\"api/chatapp/GroupNameEdit\", {\n        GROUP_NAME: this.GroupName,\n        GROUP_ID: this.CurrentGroupID\n      }).then(res => {\n        this.$message({\n          showClose: true,\n          type: \"success\",\n          message: res.data\n        });\n        this.GroupList.find(it => it.GROUP_ID == this.CurrentGroupID).GROUP_NAME = this.GroupName;\n        // console.log(gidx);\n        // if (gidx > -1) this.GroupList[gidx].GROUP_NAME = this.GroupName;\n        this.GroupEditing = false;\n      }).catch(err => {\n        this.$message({\n          showClose: true,\n          type: \"error\",\n          message: err.response.data\n        });\n      });\n    },\n    UpdateGroupFromHis(grp_info) {\n      this.GroupList.forEach((el, idx) => {\n        if (el.GROUP_ID == grp_info.GROUP_ID) {\n          this.GroupList[idx].INFO.LAST_MSG = grp_info.LAST_MSG;\n          if (this.CurrentGroupID != grp_info.GROUP_ID) {\n            this.GroupList[idx].INFO.UNREAD_NUM += grp_info.UNREAD_NUM;\n            this.TotalUnread += grp_info.UNREAD_NUM;\n          }\n        }\n      });\n    },\n    GroupClick(grp_id, grp_name) {\n      this.CurrentGroupID = grp_id;\n      this.$refs.MyHis.RefreshData(grp_id);\n      this.activeID = grp_id;\n      this.GroupName = grp_name;\n      this.addUser = false;\n      this.GroupList.forEach((el, idx) => {\n        if (el.GROUP_ID == grp_id) {\n          this.TotalUnread -= this.GroupList[idx].INFO.UNREAD_NUM;\n          this.GroupList[idx].INFO.UNREAD_NUM = 0;\n        }\n      });\n    },\n    GroupRightClick(grp) {\n      this.GroupActiveMenu = grp;\n    },\n    GetAllEMP() {\n      this.axios.get(`api/chatapp/EmpSearch?emp=all`).then(res => {\n        res.data.forEach(el => {\n          this.stringOptions.push({\n            label: el.EMP_NAME,\n            value: el.EMP_ID,\n            description: el.EMP_NO,\n            icon: \"contact_mail\"\n          });\n        });\n      }).catch(err => {\n        console.log(err);\n      });\n    },\n    abortFilterFn() {\n      console.log(\"delayed filter aborted\");\n    },\n    async filterFn(val, update) {\n      update(() => {\n        if (val === \"\") {\n          this.lstMembers = this.stringOptions;\n        } else {\n          const needle = val.toLowerCase();\n          this.lstMembers = this.stringOptions.filter(v => v.label.toLowerCase().indexOf(needle) > -1 || v.description.toLowerCase().indexOf(needle) > -1);\n        }\n      });\n    },\n    async loadImageAsBase64(imagePath) {\n      try {\n        const response = await this.axios.get(imagePath, {\n          responseType: \"blob\"\n        });\n        const reader = new FileReader();\n        reader.readAsDataURL(response.data);\n        reader.onloadend = () => {\n          this.NoImageData = reader.result.replace(\"data:image/png;base64,\", \"\");\n        };\n      } catch (error) {\n        console.error(error);\n      }\n    },\n    async GroupAvatar(group, idx) {\n      const lsrImg = [];\n      group.INFO.EMP_AVATAR.forEach(async (el, id) => {\n        if (id <= 3) {\n          if (group.INFO.EMP_AVATAR.length == 2) {\n            if (el.EMP_ID != this.GetUser.EMP_ID) {\n              lsrImg.push(el.AVATAR);\n              return;\n            }\n          } else {\n            if (el.AVATAR) lsrImg.push(el.AVATAR);else {\n              lsrImg.push(this.NoImageData);\n            }\n          }\n        } else {\n          return;\n        }\n      });\n      const mergedImageUrl = await this.ImageMerging(lsrImg);\n      if (this.GroupAvatarList[idx]) {\n        this.GroupAvatarList[idx] = mergedImageUrl;\n      } else {\n        this.GroupAvatarList.push(mergedImageUrl);\n      }\n      this.GroupList[idx].INFO.EMP_AVATAR.AVATAR = undefined;\n    },\n    async ImageMerging(imgList) {\n      if (!imgList || imgList.length > 4) {\n        return \"#\";\n      }\n      if (imgList.length <= 2) {\n        return `data:image/png;base64,${imgList[0]}`;\n      }\n      const canvasWidth = 1000;\n      const canvasHeight = 1000;\n      let canvas = createCanvas(500, 500);\n      let ctx = canvas.getContext(\"2d\");\n      var lstSyncIMG = [];\n      return new Promise((resolve, reject) => {\n        const promises = [];\n        imgList.forEach(task => {\n          const promise = new Promise((innerResolve, innerReject) => {\n            try {\n              loadImage(`data:image/png;base64,${task}`).then(res => {\n                ctx.drawImage(res, 0, 0, 500, 500);\n                loadImage(canvas.toDataURL(\"image/png\")).then(img => {\n                  lstSyncIMG.push(img);\n                  innerResolve(img);\n                }).catch(er => innerReject(er));\n              }).catch(err => innerReject(err));\n            } catch (error) {\n              innerReject(error);\n            }\n          });\n          promises.push(promise);\n        });\n        Promise.all(promises).then(() => {\n          canvas = createCanvas(canvasWidth, canvasHeight);\n          ctx = canvas.getContext(\"2d\");\n          lstSyncIMG.forEach((el, idx) => {\n            switch (idx) {\n              case 0:\n                ctx.drawImage(el, 0, 0, 500, 500);\n                break;\n              case 1:\n                ctx.drawImage(el, 500, 0, 500, 500);\n                break;\n              case 2:\n                ctx.drawImage(el, 0, 500, 500, 500);\n                break;\n              case 3:\n                ctx.drawImage(el, 500, 500, 500, 500);\n                break;\n              default:\n                break;\n            }\n          });\n          resolve(canvas.toDataURL(\"image/png\"));\n        }).catch(error => {\n          reject(error);\n        });\n      });\n    },\n    GetChatGroupList() {\n      this.axios.get(`api/chatapp/GetEmpAllGroup?emp_id=${this.GetUser.EMP_ID}`).then(res => {\n        this.TotalUnread = 0;\n        this.GroupList = res.data;\n        this.GroupList.forEach((element, idx) => {\n          this.TotalUnread += element.INFO.UNREAD_NUM;\n          this.GroupAvatar(element, idx);\n        });\n      }).catch(err => {\n        console.log(err);\n      });\n    },\n    imageFromByte(strBase64) {\n      return `data:image/jpeg;base64,${strBase64}`;\n    },\n    AddNewGroup() {\n      if (this.selectedUser && this.selectedUser.length > 0) {\n        const grp_users = {\n          GROUP_NAME: this.selectedUser.length === 1 ? this.selectedUser[0].label : this.NewGroupName,\n          ADMIN: this.GetUser.EMP_ID,\n          EMP_LIST: []\n        };\n        grp_users.EMP_LIST.push(this.GetUser.EMP_ID);\n        this.selectedUser.forEach(el => {\n          grp_users.EMP_LIST.push(el.value);\n        });\n        this.axios.post(\"api/chatapp/AddNewGroup\", grp_users).then(res => {\n          console.log(res.data);\n          this.GroupList.push(res.data[0]);\n          this.NewChat = false;\n          this.addUser = false;\n        }).catch(err => {\n          this.$message({\n            showClose: true,\n            type: \"error\",\n            message: err.response.data\n          });\n        });\n      }\n    },\n    AddGroupUser() {\n      if (this.NewChat) {\n        this.AddNewGroup();\n        return;\n      }\n      if (this.CurrentGroupID > 0) {\n        if (this.selectedUser && this.selectedUser.length > 0) {\n          const grp_users = {\n            REMOVE_EMP: false,\n            GROUP_ID: this.CurrentGroupID,\n            EMP_LIST: []\n          };\n          this.selectedUser.forEach(el => {\n            grp_users.EMP_LIST.push(el.value);\n          });\n          console.log(grp_users);\n          this.axios.post(\"api/chatapp/GroupEmpEdit\", grp_users).then(res => {\n            this.$message({\n              showClose: true,\n              type: \"success\",\n              message: res.data\n            });\n            this.addUser = false;\n          }).catch(err => {\n            console.log(err);\n          });\n        } else this.$message({\n          showClose: true,\n          type: \"error\",\n          message: \"EMP list cannot be empty!\"\n        });\n      }\n    },\n    GroupDelete() {\n      this.$messageBox.confirm(`Delete this group: (${this.GroupActiveMenu.GROUP_NAME})`, \"Warning\", {\n        confirmButtonText: \"OK\",\n        cancelButtonText: \"Cancel\",\n        type: \"warning\"\n      }).then(() => {\n        let index = this.GroupList.findIndex(item => item.GROUP_ID === this.GroupActiveMenu.GROUP_ID);\n        if (index !== -1) {\n          this.GroupList.splice(index, 1);\n        }\n        this.$message({\n          type: \"success\",\n          message: \"Delete completed\"\n        });\n      });\n    }\n  },\n  data() {\n    return {\n      NewGroupName: \"NoName\",\n      GroupEditing: false,\n      NoImageData: undefined,\n      GroupActiveMenu: undefined,\n      CurrentGroupID: 0,\n      addUser: false,\n      NewChat: false,\n      selectedUser: undefined,\n      lstMembers: [],\n      stringOptions: [],\n      tab: \"chats\",\n      splitterModel: 20,\n      Avatar: \"\",\n      drawer: false,\n      activeID: 0,\n      GroupName: \"\",\n      GroupList: [{\n        GROUP_ID: 0,\n        GROUP_NAME: \"Default\",\n        INFO: {\n          SENDER_ID: 0,\n          LAST_MSG: \"None\",\n          LAST_TIME: undefined,\n          UNREAD_NUM: 0,\n          EMP_AVATAR: undefined\n        }\n      }],\n      GroupAvatarList: [],\n      TotalUnread: 0\n    };\n  }\n};","map":{"version":3,"names":["createCanvas","loadImage","mapGetters","His","Group","components","computed","GetUser","mounted","loadImageAsBase64","setTimeout","Avatar","sessionStorage","getItem","GetChatGroupList","GetAllEMP","methods","LastMSGUpdate","msgInfo","GroupList","find","grp","GROUP_ID","group_id","INFO","LAST_MSG","msg","GroupNameEdit","axios","post","GROUP_NAME","GroupName","CurrentGroupID","then","res","$message","showClose","type","message","data","it","GroupEditing","catch","err","response","UpdateGroupFromHis","grp_info","forEach","el","idx","UNREAD_NUM","TotalUnread","GroupClick","grp_id","grp_name","$refs","MyHis","RefreshData","activeID","addUser","GroupRightClick","GroupActiveMenu","get","stringOptions","push","label","EMP_NAME","value","EMP_ID","description","EMP_NO","icon","console","log","abortFilterFn","filterFn","val","update","lstMembers","needle","toLowerCase","filter","v","indexOf","imagePath","responseType","reader","FileReader","readAsDataURL","onloadend","NoImageData","result","replace","error","GroupAvatar","group","lsrImg","EMP_AVATAR","id","length","AVATAR","mergedImageUrl","ImageMerging","GroupAvatarList","undefined","imgList","canvasWidth","canvasHeight","canvas","ctx","getContext","lstSyncIMG","Promise","resolve","reject","promises","task","promise","innerResolve","innerReject","drawImage","toDataURL","img","er","all","element","imageFromByte","strBase64","AddNewGroup","selectedUser","grp_users","NewGroupName","ADMIN","EMP_LIST","NewChat","AddGroupUser","REMOVE_EMP","GroupDelete","$messageBox","confirm","confirmButtonText","cancelButtonText","index","findIndex","item","splice","tab","splitterModel","drawer","SENDER_ID","LAST_TIME"],"sources":["D:\\LearnVueJS\\Vue3\\Projects\\fa-sop-online\\src\\components\\QMessage\\MainAppForm.vue"],"sourcesContent":["<template>\r\n  <div class=\"q-pa-md\">\r\n    <q-layout\r\n      view=\"lHh Lpr lff\"\r\n      container\r\n      style=\"height: 500px\"\r\n      class=\"shadow-2 rounded-borders\"\r\n    >\r\n      <q-header elevated class=\"bg-cyan-8\">\r\n        <q-toolbar>\r\n          <q-toolbar-title>\r\n            <div @dblclick=\"GroupEditing = true\" v-if=\"!GroupEditing\">\r\n              {{ GroupName }}\r\n            </div>\r\n            <div v-if=\"GroupEditing\">\r\n              <q-input\r\n                v-model=\"GroupName\"\r\n                dense\r\n                autofocus\r\n                counter\r\n                @keyup.enter=\"GroupNameEdit\"\r\n              />\r\n            </div>\r\n          </q-toolbar-title>\r\n          <q-btn\r\n            flat\r\n            icon=\"person_add\"\r\n            round\r\n            dense\r\n            :disable=\"CurrentGroupID <= 0\"\r\n            @click=\"\r\n              () => {\r\n                this.addUser = this.CurrentGroupID > 0;\r\n                this.NewChat = false;\r\n              }\r\n            \"\r\n          ></q-btn>\r\n          <q-btn flat @click=\"drawer = !drawer\" round dense icon=\"menu\" />\r\n          <q-btn\r\n            flat\r\n            icon=\"cancel\"\r\n            round\r\n            dense\r\n            @click=\"$emit('CloseChatBox')\"\r\n          />\r\n        </q-toolbar>\r\n      </q-header>\r\n\r\n      <q-drawer v-model=\"drawer\" show-if-above :width=\"300\" :breakpoint=\"400\">\r\n        <q-scroll-area\r\n          style=\"\r\n            height: calc(100% - 150px);\r\n            margin-top: 150px;\r\n            border-right: 1px solid #ddd;\r\n          \"\r\n        >\r\n          <div>\r\n            <q-splitter v-model=\"splitterModel\" style=\"height: 350px\">\r\n              <template v-slot:before>\r\n                <q-tabs\r\n                  v-model=\"tab\"\r\n                  indicator-color=\"transparent\"\r\n                  active-color=\"lime-11\"\r\n                  class=\"bg-teal text-grey-5 shadow-2\"\r\n                  vertical\r\n                  style=\"height: 100%\"\r\n                >\r\n                  <q-tab name=\"chats\" icon=\"chat\">\r\n                    <q-badge v-if=\"TotalUnread > 0\" color=\"red\" floating>{{\r\n                      TotalUnread\r\n                    }}</q-badge>\r\n                  </q-tab>\r\n                  <q-tab name=\"friends\" icon=\"group\" />\r\n                  <q-tab name=\"others\" icon=\"favorite\" />\r\n                </q-tabs>\r\n              </template>\r\n\r\n              <template v-slot:after>\r\n                <q-tab-panels\r\n                  v-model=\"tab\"\r\n                  animated\r\n                  swipeable\r\n                  vertical\r\n                  transition-prev=\"jump-up\"\r\n                  transition-next=\"jump-up\"\r\n                >\r\n                  <q-tab-panel name=\"chats\">\r\n                    <q-list\r\n                      style=\"margin-left: -15px\"\r\n                      v-for=\"(grp, idx) in GroupList\"\r\n                      :key=\"idx\"\r\n                    >\r\n                      <q-menu\r\n                        style=\"z-index: 9999\"\r\n                        touch-position\r\n                        context-menu\r\n                        ref=\"myMenu\"\r\n                        transition-show=\"scale\"\r\n                        transition-hide=\"scale\"\r\n                      >\r\n                        <q-list style=\"min-width: 100px\">\r\n                          <q-item\r\n                            clickable\r\n                            v-close-popup\r\n                            @click=\"\r\n                              () => {\r\n                                this.addUser = true;\r\n                                this.NewChat = true;\r\n                              }\r\n                            \"\r\n                          >\r\n                            <q-item-section avatar>\r\n                              <q-icon color=\"indigo-14\" name=\"add_comment\" />\r\n                            </q-item-section>\r\n                            <q-item-section style=\"margin-left: -25px\"\r\n                              >New Chat</q-item-section\r\n                            >\r\n                          </q-item>\r\n                          <q-item clickable v-close-popup>\r\n                            <q-item-section avatar>\r\n                              <q-icon color=\"indigo-14\" name=\"fact_check\" />\r\n                            </q-item-section>\r\n                            <q-item-section style=\"margin-left: -25px\"\r\n                              >Group Manage</q-item-section\r\n                            >\r\n                          </q-item>\r\n                          <q-item clickable v-close-popup>\r\n                            <q-item-section avatar>\r\n                              <q-icon color=\"red-13\" name=\"clear_all\" />\r\n                            </q-item-section>\r\n                            <q-item-section style=\"margin-left: -25px\"\r\n                              >Clear History</q-item-section\r\n                            >\r\n                          </q-item>\r\n                          <q-item clickable v-close-popup @click=\"GroupDelete\">\r\n                            <q-item-section avatar>\r\n                              <q-icon color=\"red-13\" name=\"delete\" />\r\n                            </q-item-section>\r\n                            <q-item-section style=\"margin-left: -25px\"\r\n                              >Delete Group</q-item-section\r\n                            >\r\n                          </q-item>\r\n                        </q-list>\r\n                      </q-menu>\r\n                      <q-item\r\n                        style=\"margin-left: -15px; margin-right: -15px\"\r\n                        :active=\"grp.GROUP_ID == activeID\"\r\n                        clickable\r\n                        v-ripple\r\n                        active-class=\"GroupActiveClass\"\r\n                        @click=\"GroupClick(grp.GROUP_ID, grp.GROUP_NAME)\"\r\n                        @contextmenu=\"GroupRightClick(grp)\"\r\n                      >\r\n                        <q-item-section avatar>\r\n                          <q-avatar>\r\n                            <img :src=\"GroupAvatarList[idx]\" />\r\n                          </q-avatar>\r\n                        </q-item-section>\r\n                        <q-item-section style=\"margin: -15px\">\r\n                          <Group\r\n                            :GroupName=\"grp.GROUP_NAME\"\r\n                            :LastMsg=\"GroupList[idx].INFO.LAST_MSG\"\r\n                            :UnreadNum=\"GroupList[idx].INFO.UNREAD_NUM\"\r\n                          >\r\n                          </Group>\r\n                        </q-item-section>\r\n                      </q-item>\r\n                      <q-separator\r\n                        v-show=\"!(grp.GROUP_ID == activeID)\"\r\n                        color=\"grey-4\"\r\n                      />\r\n                    </q-list>\r\n                  </q-tab-panel>\r\n\r\n                  <q-tab-panel name=\"friends\">\r\n                    <div class=\"text-h4 q-mb-md\">Alarms</div>\r\n                    <p>N/A</p>\r\n                  </q-tab-panel>\r\n\r\n                  <q-tab-panel name=\"others\">\r\n                    <div class=\"text-h4 q-mb-md\">Movies</div>\r\n                    <p>\r\n                      Lorem ipsum dolor sit, amet consectetur adipisicing elit.\r\n                      Quis praesentium cumque magnam odio iure quidem, quod\r\n                      illum numquam possimus obcaecati commodi minima assumenda\r\n                      consectetur culpa fuga nulla ullam. In, libero. Lorem\r\n                      ipsum dolor sit, amet consectetur adipisicing elit. Quis\r\n                      praesentium cumque magnam odio iure quidem, quod illum\r\n                      numquam possimus obcaecati commodi minima assumenda\r\n                      consectetur culpa fuga nulla ullam. In, libero.\r\n                    </p>\r\n                  </q-tab-panel>\r\n                </q-tab-panels>\r\n              </template>\r\n            </q-splitter>\r\n          </div>\r\n        </q-scroll-area>\r\n\r\n        <q-img\r\n          class=\"absolute-top\"\r\n          src=\"../../assets/userBGR.png\"\r\n          style=\"height: 150px\"\r\n        >\r\n          <div class=\"absolute-bottom bg-transparent\">\r\n            <q-avatar size=\"56px\" class=\"q-mb-sm\" style=\"cursor: pointer\">\r\n              <img :src=\"imageFromByte(Avatar)\" />\r\n            </q-avatar>\r\n            <div class=\"text-weight-bold\">{{ GetUser.Name }}</div>\r\n            <div>{{ GetUser.Email }}</div>\r\n          </div>\r\n        </q-img>\r\n      </q-drawer>\r\n\r\n      <q-page-container class=\"custom-page-container\">\r\n        <q-page>\r\n          <His\r\n            ref=\"MyHis\"\r\n            @UpdateGroupInfo=\"UpdateGroupFromHis\"\r\n            @UpdateLastMSG=\"LastMSGUpdate\"\r\n          ></His>\r\n          <div\r\n            v-if=\"addUser\"\r\n            class=\"fit absolute-center\"\r\n            style=\"background-color: rgba(0, 255, 255, 0.596)\"\r\n          >\r\n            <div class=\"myDialog absolute-center\">\r\n              <q-input\r\n                v-if=\"NewChat\"\r\n                clearable\r\n                v-model=\"NewGroupName\"\r\n                label=\"Group Name\"\r\n                input-style=\"text-align: center; font-size: 2em;\"\r\n                style=\"margin-left: 10px; margin-right: 10px;\"\r\n              ></q-input>\r\n              <q-select\r\n                v-model=\"selectedUser\"\r\n                clearable\r\n                use-input\r\n                options-selected-class=\"text-deep-orange\"\r\n                label=\"Select Emp\"\r\n                :options=\"lstMembers\"\r\n                @filter=\"filterFn\"\r\n                @filter-abort=\"abortFilterFn\"\r\n                style=\"margin: 5px\"\r\n                multiple\r\n                counter\r\n                :popup-content-style=\"'z-index: 9999;'\"\r\n              >\r\n                <template v-slot:option=\"scope\">\r\n                  <q-item v-bind=\"scope.itemProps\">\r\n                    <q-item-section avatar>\r\n                      <q-icon :name=\"scope.opt.icon\" />\r\n                    </q-item-section>\r\n                    <q-item-section>\r\n                      <q-item-label>{{ scope.opt.label }}</q-item-label>\r\n                      <q-item-label caption>{{\r\n                        scope.opt.description\r\n                      }}</q-item-label>\r\n                    </q-item-section>\r\n                  </q-item>\r\n                </template>\r\n              </q-select>\r\n              <div class=\"absolute-bottom\">\r\n                <q-btn\r\n                  icon=\"done\"\r\n                  color=\"primary\"\r\n                  style=\"width: 150px; margin: 5px\"\r\n                  @click=\"AddGroupUser\"\r\n                  >OK</q-btn\r\n                >\r\n                <q-btn\r\n                  icon=\"cancel\"\r\n                  color=\"red\"\r\n                  style=\"width: 150px; margin: 5px\"\r\n                  @click=\"addUser = false\"\r\n                  >Cancel</q-btn\r\n                >\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </q-page>\r\n      </q-page-container>\r\n    </q-layout>\r\n  </div>\r\n</template>\r\n  \r\n  <script>\r\nimport { createCanvas, loadImage } from \"canvas\";\r\nimport { mapGetters } from \"vuex\";\r\nimport His from \"./HistoryBox.vue\";\r\nimport Group from \"./GroupInfo.vue\";\r\nexport default {\r\n  components: {\r\n    His,\r\n    Group,\r\n  },\r\n  computed: {\r\n    ...mapGetters({\r\n      GetUser: \"getUser\",\r\n    }),\r\n  },\r\n  mounted() {\r\n    this.loadImageAsBase64(\"Images/noImg.png\");\r\n    setTimeout(() => {\r\n      this.Avatar = sessionStorage.getItem(\"Avatar\");\r\n      this.GetChatGroupList();\r\n      this.GetAllEMP();\r\n    }, 500);\r\n  },\r\n  methods: {\r\n    LastMSGUpdate(msgInfo) {\r\n      this.GroupList.find(\r\n        (grp) => grp.GROUP_ID == msgInfo.group_id\r\n      ).INFO.LAST_MSG = msgInfo.msg;\r\n    },\r\n    async GroupNameEdit() {\r\n      await this.axios\r\n        .post(\"api/chatapp/GroupNameEdit\", {\r\n          GROUP_NAME: this.GroupName,\r\n          GROUP_ID: this.CurrentGroupID,\r\n        })\r\n        .then((res) => {\r\n          this.$message({\r\n            showClose: true,\r\n            type: \"success\",\r\n            message: res.data,\r\n          });\r\n          this.GroupList.find(\r\n            (it) => it.GROUP_ID == this.CurrentGroupID\r\n          ).GROUP_NAME = this.GroupName;\r\n          // console.log(gidx);\r\n          // if (gidx > -1) this.GroupList[gidx].GROUP_NAME = this.GroupName;\r\n          this.GroupEditing = false;\r\n        })\r\n        .catch((err) => {\r\n          this.$message({\r\n            showClose: true,\r\n            type: \"error\",\r\n            message: err.response.data,\r\n          });\r\n        });\r\n    },\r\n    UpdateGroupFromHis(grp_info) {\r\n      this.GroupList.forEach((el, idx) => {\r\n        if (el.GROUP_ID == grp_info.GROUP_ID) {\r\n          this.GroupList[idx].INFO.LAST_MSG = grp_info.LAST_MSG;\r\n          if (this.CurrentGroupID != grp_info.GROUP_ID) {\r\n            this.GroupList[idx].INFO.UNREAD_NUM += grp_info.UNREAD_NUM;\r\n            this.TotalUnread += grp_info.UNREAD_NUM;\r\n          }\r\n        }\r\n      });\r\n    },\r\n    GroupClick(grp_id, grp_name) {\r\n      this.CurrentGroupID = grp_id;\r\n      this.$refs.MyHis.RefreshData(grp_id);\r\n      this.activeID = grp_id;\r\n      this.GroupName = grp_name;\r\n      this.addUser = false;\r\n      this.GroupList.forEach((el, idx) => {\r\n        if (el.GROUP_ID == grp_id) {\r\n          this.TotalUnread -= this.GroupList[idx].INFO.UNREAD_NUM;\r\n          this.GroupList[idx].INFO.UNREAD_NUM = 0;\r\n        }\r\n      });\r\n    },\r\n    GroupRightClick(grp) {\r\n      this.GroupActiveMenu = grp;\r\n    },\r\n    GetAllEMP() {\r\n      this.axios\r\n        .get(`api/chatapp/EmpSearch?emp=all`)\r\n        .then((res) => {\r\n          res.data.forEach((el) => {\r\n            this.stringOptions.push({\r\n              label: el.EMP_NAME,\r\n              value: el.EMP_ID,\r\n              description: el.EMP_NO,\r\n              icon: \"contact_mail\",\r\n            });\r\n          });\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n        });\r\n    },\r\n    abortFilterFn() {\r\n      console.log(\"delayed filter aborted\");\r\n    },\r\n    async filterFn(val, update) {\r\n      update(() => {\r\n        if (val === \"\") {\r\n          this.lstMembers = this.stringOptions;\r\n        } else {\r\n          const needle = val.toLowerCase();\r\n          this.lstMembers = this.stringOptions.filter(\r\n            (v) =>\r\n              v.label.toLowerCase().indexOf(needle) > -1 ||\r\n              v.description.toLowerCase().indexOf(needle) > -1\r\n          );\r\n        }\r\n      });\r\n    },\r\n    async loadImageAsBase64(imagePath) {\r\n      try {\r\n        const response = await this.axios.get(imagePath, {\r\n          responseType: \"blob\",\r\n        });\r\n        const reader = new FileReader();\r\n        reader.readAsDataURL(response.data);\r\n\r\n        reader.onloadend = () => {\r\n          this.NoImageData = reader.result.replace(\r\n            \"data:image/png;base64,\",\r\n            \"\"\r\n          );\r\n        };\r\n      } catch (error) {\r\n        console.error(error);\r\n      }\r\n    },\r\n    async GroupAvatar(group, idx) {\r\n      const lsrImg = [];\r\n      group.INFO.EMP_AVATAR.forEach(async (el, id) => {\r\n        if (id <= 3) {\r\n          if (group.INFO.EMP_AVATAR.length == 2) {\r\n            if (el.EMP_ID != this.GetUser.EMP_ID) {\r\n              lsrImg.push(el.AVATAR);\r\n              return;\r\n            }\r\n          } else {\r\n            if (el.AVATAR) lsrImg.push(el.AVATAR);\r\n            else {\r\n              lsrImg.push(this.NoImageData);\r\n            }\r\n          }\r\n        } else {\r\n          return;\r\n        }\r\n      });\r\n      const mergedImageUrl = await this.ImageMerging(lsrImg);\r\n      if (this.GroupAvatarList[idx]) {\r\n        this.GroupAvatarList[idx] = mergedImageUrl;\r\n      } else {\r\n        this.GroupAvatarList.push(mergedImageUrl);\r\n      }\r\n      this.GroupList[idx].INFO.EMP_AVATAR.AVATAR = undefined;\r\n    },\r\n    async ImageMerging(imgList) {\r\n      if (!imgList || imgList.length > 4) {\r\n        return \"#\";\r\n      }\r\n      if (imgList.length <= 2) {\r\n        return `data:image/png;base64,${imgList[0]}`;\r\n      }\r\n      const canvasWidth = 1000;\r\n      const canvasHeight = 1000;\r\n      let canvas = createCanvas(500, 500);\r\n      let ctx = canvas.getContext(\"2d\");\r\n      var lstSyncIMG = [];\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const promises = [];\r\n\r\n        imgList.forEach((task) => {\r\n          const promise = new Promise((innerResolve, innerReject) => {\r\n            try {\r\n              loadImage(`data:image/png;base64,${task}`)\r\n                .then((res) => {\r\n                  ctx.drawImage(res, 0, 0, 500, 500);\r\n                  loadImage(canvas.toDataURL(\"image/png\"))\r\n                    .then((img) => {\r\n                      lstSyncIMG.push(img);\r\n                      innerResolve(img);\r\n                    })\r\n                    .catch((er) => innerReject(er));\r\n                })\r\n                .catch((err) => innerReject(err));\r\n            } catch (error) {\r\n              innerReject(error);\r\n            }\r\n          });\r\n\r\n          promises.push(promise);\r\n        });\r\n\r\n        Promise.all(promises)\r\n          .then(() => {\r\n            canvas = createCanvas(canvasWidth, canvasHeight);\r\n            ctx = canvas.getContext(\"2d\");\r\n\r\n            lstSyncIMG.forEach((el, idx) => {\r\n              switch (idx) {\r\n                case 0:\r\n                  ctx.drawImage(el, 0, 0, 500, 500);\r\n                  break;\r\n                case 1:\r\n                  ctx.drawImage(el, 500, 0, 500, 500);\r\n                  break;\r\n                case 2:\r\n                  ctx.drawImage(el, 0, 500, 500, 500);\r\n                  break;\r\n                case 3:\r\n                  ctx.drawImage(el, 500, 500, 500, 500);\r\n                  break;\r\n                default:\r\n                  break;\r\n              }\r\n            });\r\n\r\n            resolve(canvas.toDataURL(\"image/png\"));\r\n          })\r\n          .catch((error) => {\r\n            reject(error);\r\n          });\r\n      });\r\n    },\r\n    GetChatGroupList() {\r\n      this.axios\r\n        .get(`api/chatapp/GetEmpAllGroup?emp_id=${this.GetUser.EMP_ID}`)\r\n        .then((res) => {\r\n          this.TotalUnread = 0;\r\n          this.GroupList = res.data;\r\n          this.GroupList.forEach((element, idx) => {\r\n            this.TotalUnread += element.INFO.UNREAD_NUM;\r\n            this.GroupAvatar(element, idx);\r\n          });\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n        });\r\n    },\r\n    imageFromByte(strBase64) {\r\n      return `data:image/jpeg;base64,${strBase64}`;\r\n    },\r\n    AddNewGroup() {\r\n      if (this.selectedUser && this.selectedUser.length > 0) {\r\n        const grp_users = {\r\n          GROUP_NAME:\r\n            this.selectedUser.length === 1\r\n              ? this.selectedUser[0].label\r\n              : this.NewGroupName,\r\n          ADMIN: this.GetUser.EMP_ID,\r\n          EMP_LIST: [],\r\n        };\r\n        grp_users.EMP_LIST.push(this.GetUser.EMP_ID);\r\n        this.selectedUser.forEach((el) => {\r\n          grp_users.EMP_LIST.push(el.value);\r\n        });\r\n\r\n        this.axios\r\n          .post(\"api/chatapp/AddNewGroup\", grp_users)\r\n          .then((res) => {\r\n            console.log(res.data);\r\n            this.GroupList.push(res.data[0]);\r\n            this.NewChat = false;\r\n            this.addUser = false;\r\n          })\r\n          .catch((err) => {\r\n            this.$message({\r\n              showClose: true,\r\n              type: \"error\",\r\n              message: err.response.data,\r\n            });\r\n          });\r\n      }\r\n    },\r\n    AddGroupUser() {\r\n      if (this.NewChat) {\r\n        this.AddNewGroup();\r\n        return;\r\n      }\r\n      if (this.CurrentGroupID > 0) {\r\n        if (this.selectedUser && this.selectedUser.length > 0) {\r\n          const grp_users = {\r\n            REMOVE_EMP: false,\r\n            GROUP_ID: this.CurrentGroupID,\r\n            EMP_LIST: [],\r\n          };\r\n          this.selectedUser.forEach((el) => {\r\n            grp_users.EMP_LIST.push(el.value);\r\n          });\r\n          console.log(grp_users);\r\n          this.axios\r\n            .post(\"api/chatapp/GroupEmpEdit\", grp_users)\r\n            .then((res) => {\r\n              this.$message({\r\n                showClose: true,\r\n                type: \"success\",\r\n                message: res.data,\r\n              });\r\n              this.addUser = false;\r\n            })\r\n            .catch((err) => {\r\n              console.log(err);\r\n            });\r\n        } else\r\n          this.$message({\r\n            showClose: true,\r\n            type: \"error\",\r\n            message: \"EMP list cannot be empty!\",\r\n          });\r\n      }\r\n    },\r\n    GroupDelete() {\r\n      this.$messageBox\r\n        .confirm(\r\n          `Delete this group: (${this.GroupActiveMenu.GROUP_NAME})`,\r\n          \"Warning\",\r\n          {\r\n            confirmButtonText: \"OK\",\r\n            cancelButtonText: \"Cancel\",\r\n            type: \"warning\",\r\n          }\r\n        )\r\n        .then(() => {\r\n          let index = this.GroupList.findIndex(\r\n            (item) => item.GROUP_ID === this.GroupActiveMenu.GROUP_ID\r\n          );\r\n          if (index !== -1) {\r\n            this.GroupList.splice(index, 1);\r\n          }\r\n          this.$message({\r\n            type: \"success\",\r\n            message: \"Delete completed\",\r\n          });\r\n        });\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      NewGroupName: \"NoName\",\r\n      GroupEditing: false,\r\n      NoImageData: undefined,\r\n      GroupActiveMenu: undefined,\r\n      CurrentGroupID: 0,\r\n      addUser: false,\r\n      NewChat: false,\r\n      selectedUser: undefined,\r\n      lstMembers: [],\r\n      stringOptions: [],\r\n      tab: \"chats\",\r\n      splitterModel: 20,\r\n      Avatar: \"\",\r\n      drawer: false,\r\n      activeID: 0,\r\n      GroupName: \"\",\r\n      GroupList: [\r\n        {\r\n          GROUP_ID: 0,\r\n          GROUP_NAME: \"Default\",\r\n          INFO: {\r\n            SENDER_ID: 0,\r\n            LAST_MSG: \"None\",\r\n            LAST_TIME: undefined,\r\n            UNREAD_NUM: 0,\r\n            EMP_AVATAR: undefined,\r\n          },\r\n        },\r\n      ],\r\n      GroupAvatarList: [],\r\n      TotalUnread: 0,\r\n    };\r\n  },\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.selectEMPStyle {\r\n  z-index: 999;\r\n  max-height: 300px;\r\n}\r\n.myDialog {\r\n  background-color: rgb(255, 255, 255);\r\n  width: 80%;\r\n  height: 50%;\r\n  border-radius: 5px;\r\n}\r\n.custom-page-container {\r\n  background-color: #1f144b;\r\n}\r\n.GroupActiveClass {\r\n  background-color: aquamarine;\r\n}\r\n</style>\r\n  "],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}