{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { mapGetters } from \"vuex\";\nimport Qmsg from \"./Qmsg.vue\";\nimport ctlBar from \"./MsgSender.vue\";\nexport default {\n  name: \"HistoryBox\",\n  components: {\n    Qmsg,\n    ctlBar\n  },\n  computed: {\n    ...mapGetters({\n      GetUser: \"getUser\"\n    })\n  },\n  props: {},\n  mounted() {\n    this.RefreshData();\n  },\n  data() {\n    return {\n      GroupID: 0,\n      testIMG: \"\",\n      MSGTextColor: {\n        Sender: \"indigo-14\",\n        Receiver: \"blue-grey-3\"\n      },\n      members: undefined,\n      ChatHis: []\n    };\n  },\n  methods: {\n    LocalSentMSG(msg) {\n      msg = {\n        Sender: this.GetUser.EMP_NAME,\n        ID: this.GetUser.EMP_ID,\n        message: [{\n          text: msg\n        }]\n      };\n    },\n    RefreshData(group_id) {\n      if (group_id > 0 && group_id != this.GroupID) {\n        this.GroupID = group_id;\n        this.GetMemberInfor();\n        this.GetChatHistory();\n      }\n    },\n    ShowAvatar(member) {\n      if (this.members) this.members.forEach(item => {\n        if (item.EMP_ID == member) {\n          return {\n            img: this.imageFromByte(item.AVATAR)\n          };\n        }\n      });\n    },\n    imageFromByte(strBase64) {\n      return `data:image/jpeg;base64,${strBase64}`;\n    },\n    async GetMemberInfor() {\n      await this.axios.get(`api/chatapp/GetGroupMemberInfo?groupID=${this.GroupID}`).then(res => {\n        this.members = res.data;\n        this.testIMG = this.members[0].AVATAR;\n      }).catch(err => {\n        console.log(err.response.data);\n      });\n    },\n    async GetChatHistory() {\n      await this.axios.get(`api/chatapp/GetHistory?groupID=${this.GroupID}`).then(res => {\n        var sentEMP = res.data[0].SENDER_ID;\n        var msg = undefined;\n        res.data.forEach(item => {\n          if (!msg) {\n            msg = {\n              Sender: item.SENDER,\n              ID: item.SENDER_ID,\n              message: [{\n                text: item.MES_CONTENT\n              }]\n            };\n          } else {\n            if (sentEMP == item.SENDER_ID) {\n              msg.message.push({\n                text: item.MES_CONTENT\n              });\n            } else {\n              this.ChatHis.push(msg);\n              msg = {\n                Sender: item.SENDER,\n                ID: item.SENDER_ID,\n                message: [{\n                  text: item.MES_CONTENT\n                }]\n              };\n            }\n          }\n          sentEMP = item.SENDER_ID;\n        });\n        this.ChatHis.push(msg);\n        setTimeout(() => {\n          this.$refs.hisScroll.setScrollPercentage(\"vertical\", 1, 300);\n        }, 100);\n      }).catch(err => {\n        this.ChatHis = [];\n        console.log(err);\n      });\n    }\n  }\n};","map":{"version":3,"names":["mapGetters","Qmsg","ctlBar","name","components","computed","GetUser","props","mounted","RefreshData","data","GroupID","testIMG","MSGTextColor","Sender","Receiver","members","undefined","ChatHis","methods","LocalSentMSG","msg","EMP_NAME","ID","EMP_ID","message","text","group_id","GetMemberInfor","GetChatHistory","ShowAvatar","member","forEach","item","img","imageFromByte","AVATAR","strBase64","axios","get","then","res","catch","err","console","log","response","sentEMP","SENDER_ID","SENDER","MES_CONTENT","push","setTimeout","$refs","hisScroll","setScrollPercentage"],"sources":["D:\\LearnVueJS\\Vue3\\Projects\\fa-sop-online\\src\\components\\QMessage\\HistoryBox.vue"],"sourcesContent":["<template>\r\n  <div class=\"hello\">\r\n    <q-scroll-area\r\n      dark\r\n      class=\"text-white rounded-borders\"\r\n      style=\"width: 100%; height: 370px\"\r\n      ref=\"hisScroll\"\r\n    >\r\n      <div class=\"q-pa-md row justify-center\" style=\"padding: 0 !important\">\r\n        <div style=\"width: 100%\">\r\n          <Qmsg\r\n            v-for=\"(msg, id) in ChatHis\"\r\n            :key=\"id\"\r\n            :Name=\"msg.Sender\"\r\n            :MemberID=\"msg.ID\"\r\n            :BGColor=\"\r\n              msg.Sender == 'NinhLe'\r\n                ? MSGTextColor.Sender\r\n                : MSGTextColor.Receiver\r\n            \"\r\n            :Message=\"msg.message\"\r\n            :Sent=\"msg.ID == GetUser.EMP_ID\"\r\n            Stamp=\"7 minutes ago\"\r\n            TextColor=\"white\"\r\n          ></Qmsg>\r\n        </div>\r\n      </div>\r\n    </q-scroll-area>\r\n    <ctlBar @MessageSent=\"LocalSentMSG(msg)\"></ctlBar>\r\n  </div>\r\n</template>\r\n  \r\n  <script>\r\nimport { mapGetters } from \"vuex\";\r\nimport Qmsg from \"./Qmsg.vue\";\r\nimport ctlBar from \"./MsgSender.vue\";\r\nexport default {\r\n  name: \"HistoryBox\",\r\n  components: {\r\n    Qmsg,\r\n    ctlBar,\r\n  },\r\n  computed: {\r\n    ...mapGetters({\r\n      GetUser: \"getUser\",\r\n    }),\r\n  },\r\n  props: {},\r\n  mounted() {\r\n    this.RefreshData();\r\n  },\r\n  data() {\r\n    return {\r\n      GroupID: 0,\r\n      testIMG: \"\",\r\n      MSGTextColor: { Sender: \"indigo-14\", Receiver: \"blue-grey-3\" },\r\n      members: undefined,\r\n      ChatHis: [],\r\n    };\r\n  },\r\n  methods: {\r\n    LocalSentMSG(msg){\r\n      msg = {\r\n                Sender: this.GetUser.EMP_NAME,\r\n                ID: this.GetUser.EMP_ID,\r\n                message: [{ text: msg }],\r\n              };\r\n    },\r\n    RefreshData(group_id) {\r\n      if (group_id > 0 && group_id != this.GroupID) {\r\n        this.GroupID = group_id;\r\n        this.GetMemberInfor();\r\n        this.GetChatHistory();\r\n      }\r\n    },\r\n    ShowAvatar(member) {\r\n      if (this.members)\r\n        this.members.forEach((item) => {\r\n          if (item.EMP_ID == member) {\r\n            return { img: this.imageFromByte(item.AVATAR) };\r\n          }\r\n        });\r\n    },\r\n    imageFromByte(strBase64) {\r\n      return `data:image/jpeg;base64,${strBase64}`;\r\n    },\r\n    async GetMemberInfor() {\r\n      await this.axios\r\n        .get(`api/chatapp/GetGroupMemberInfo?groupID=${this.GroupID}`)\r\n        .then((res) => {\r\n          this.members = res.data;\r\n          this.testIMG = this.members[0].AVATAR;\r\n        })\r\n        .catch((err) => {\r\n          console.log(err.response.data);\r\n        });\r\n    },\r\n    async GetChatHistory() {\r\n      await this.axios\r\n        .get(`api/chatapp/GetHistory?groupID=${this.GroupID}`)\r\n        .then((res) => {\r\n          var sentEMP = res.data[0].SENDER_ID;\r\n          var msg = undefined;\r\n          res.data.forEach((item) => {\r\n            if (!msg) {\r\n              msg = {\r\n                Sender: item.SENDER,\r\n                ID: item.SENDER_ID,\r\n                message: [{ text: item.MES_CONTENT }],\r\n              };\r\n            } else {\r\n              if (sentEMP == item.SENDER_ID) {\r\n                msg.message.push({ text: item.MES_CONTENT });\r\n              } else {\r\n                this.ChatHis.push(msg);\r\n                msg = {\r\n                  Sender: item.SENDER,\r\n                  ID: item.SENDER_ID,\r\n                  message: [{ text: item.MES_CONTENT }],\r\n                };\r\n              }\r\n            }\r\n            sentEMP = item.SENDER_ID;\r\n          });\r\n          this.ChatHis.push(msg);\r\n          setTimeout(() => {\r\n            this.$refs.hisScroll.setScrollPercentage(\"vertical\", 1, 300);\r\n          }, 100);\r\n        })\r\n        .catch((err) => {\r\n          this.ChatHis = [];\r\n          console.log(err);\r\n        });\r\n    },\r\n  },\r\n};\r\n</script>\r\n  \r\n  <!-- Add \"scoped\" attribute to limit CSS to this component only -->\r\n  <style lang=\"scss\" scoped>\r\n.hello {\r\n  margin: {\r\n    left: 5px;\r\n    right: 5px;\r\n  }\r\n}\r\n</style>\r\n  "],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}