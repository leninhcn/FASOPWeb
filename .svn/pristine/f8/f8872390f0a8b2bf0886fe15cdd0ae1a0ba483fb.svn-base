{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { createCanvas, loadImage } from \"canvas\";\nimport { mapGetters } from \"vuex\";\nimport His from \"./HistoryBox.vue\";\nimport Group from \"./GroupInfo.vue\";\nexport default {\n  components: {\n    His,\n    Group\n  },\n  computed: {\n    ...mapGetters({\n      GetUser: \"getUser\"\n    })\n  },\n  mounted() {\n    this.Avatar = sessionStorage.getItem(\"Avatar\");\n    this.GetChatGroupList();\n  },\n  methods: {\n    async GroupAvatar(group_id) {\n      console.log(group_id);\n      const group = this.GroupList.find(item => item.GROUP_ID === group_id);\n      const lsrImg = [];\n      group.INFO.EMP_AVATAR.forEach((el, id) => {\n        if (id <= 3) {\n          lsrImg.push(el.AVATAR);\n        } else {\n          return;\n        }\n      });\n      this.mergedImageUrl = await this.ImageMerging(lsrImg);\n      return undefined;\n    },\n    async ImageMerging(imgList) {\n      if (!imgList || imgList.lenght > 4) {\n        return \"#\";\n      }\n      if (imgList.lenght <= 2) {\n        return `data:image/png;base64,${imgList[0]}`;\n      }\n      const canvasWidth = 1000;\n      const canvasHeight = 1000;\n\n      // Tạo đối tượng canvas với kích thước tương ứng\n      let canvas = createCanvas(500, 500);\n      let ctx = canvas.getContext(\"2d\");\n      var lstSyncIMG = [];\n      return new Promise((resolve, reject) => {\n        const promises = [];\n        imgList.forEach(task => {\n          const promise = new Promise((innerResolve, innerReject) => {\n            try {\n              loadImage(`data:image/png;base64,${task}`).then(res => {\n                ctx.drawImage(res, 0, 0, 500, 500);\n                loadImage(canvas.toDataURL(\"image/png\")).then(img => {\n                  lstSyncIMG.push(img);\n                  innerResolve(img);\n                }).catch(er => innerReject(er));\n              }).catch(err => innerReject(err));\n            } catch (error) {\n              innerReject(error);\n            }\n          });\n          promises.push(promise);\n        });\n        Promise.all(promises).then(() => {\n          canvas = createCanvas(canvasWidth, canvasHeight);\n          ctx = canvas.getContext(\"2d\");\n          lstSyncIMG.forEach((el, idx) => {\n            switch (idx) {\n              case 0:\n                ctx.drawImage(el, 0, 0, 500, 500);\n                break;\n              case 1:\n                ctx.drawImage(el, 500, 0, 500, 500);\n                break;\n              case 2:\n                ctx.drawImage(el, 0, 500, 500, 500);\n                break;\n              case 3:\n                ctx.drawImage(el, 500, 500, 500, 500);\n                break;\n              default:\n                break;\n            }\n          });\n          resolve(canvas.toDataURL(\"image/png\"));\n        }).catch(error => {\n          reject(error);\n        });\n      });\n    },\n    QItemClick(id) {\n      this.activeID = id;\n    },\n    GetChatGroupList() {\n      this.axios.get(`api/chatapp/GetEmpAllGroup?emp_id=${this.GetUser.EMP_ID}`).then(res => {\n        this.GroupList = res.data;\n      }).catch(err => {\n        console.log(err);\n      });\n    },\n    imageFromByte(strBase64) {\n      return `data:image/jpeg;base64,${strBase64}`;\n    }\n  },\n  data() {\n    return {\n      tab: \"chats\",\n      splitterModel: 20,\n      Avatar: \"\",\n      drawer: false,\n      activeID: 0,\n      GroupName: \"Test-Group\",\n      GroupList: [{\n        GROUP_ID: 0,\n        GROUP_NAME: \"Default\"\n      }]\n    };\n  }\n};","map":{"version":3,"names":["createCanvas","loadImage","mapGetters","His","Group","components","computed","GetUser","mounted","Avatar","sessionStorage","getItem","GetChatGroupList","methods","GroupAvatar","group_id","console","log","group","GroupList","find","item","GROUP_ID","lsrImg","INFO","EMP_AVATAR","forEach","el","id","push","AVATAR","mergedImageUrl","ImageMerging","undefined","imgList","lenght","canvasWidth","canvasHeight","canvas","ctx","getContext","lstSyncIMG","Promise","resolve","reject","promises","task","promise","innerResolve","innerReject","then","res","drawImage","toDataURL","img","catch","er","err","error","all","idx","QItemClick","activeID","axios","get","EMP_ID","data","imageFromByte","strBase64","tab","splitterModel","drawer","GroupName","GROUP_NAME"],"sources":["D:\\LearnVueJS\\Vue3\\Projects\\fa-sop-online\\src\\components\\QMessage\\MainAppForm.vue"],"sourcesContent":["<template>\r\n  <div class=\"q-pa-md\">\r\n    <q-layout\r\n      view=\"lHh Lpr lff\"\r\n      container\r\n      style=\"height: 500px\"\r\n      class=\"shadow-2 rounded-borders\"\r\n    >\r\n      <q-header elevated class=\"bg-cyan-8\">\r\n        <q-toolbar>\r\n          <q-toolbar-title>{{ GroupName }}</q-toolbar-title>\r\n          <q-btn flat @click=\"drawer = !drawer\" round dense icon=\"menu\" />\r\n          <q-btn\r\n            flat\r\n            icon=\"cancel\"\r\n            round\r\n            dense\r\n            @click=\"$emit('CloseChatBox')\"\r\n          />\r\n        </q-toolbar>\r\n      </q-header>\r\n\r\n      <q-drawer v-model=\"drawer\" show-if-above :width=\"300\" :breakpoint=\"400\">\r\n        <q-scroll-area\r\n          style=\"\r\n            height: calc(100% - 150px);\r\n            margin-top: 150px;\r\n            border-right: 1px solid #ddd;\r\n          \"\r\n        >\r\n          <div>\r\n            <q-splitter v-model=\"splitterModel\" style=\"height: 100%\">\r\n              <template v-slot:before>\r\n                <q-tabs v-model=\"tab\" vertical class=\"text-teal\">\r\n                  <q-tab name=\"chats\" icon=\"chat\">\r\n                    <q-badge color=\"red\" floating>6</q-badge>\r\n                  </q-tab>\r\n                  <q-tab name=\"friends\" icon=\"group\" />\r\n                  <q-tab name=\"others\" icon=\"favorite\" />\r\n                </q-tabs>\r\n              </template>\r\n\r\n              <template v-slot:after>\r\n                <q-tab-panels\r\n                  v-model=\"tab\"\r\n                  indicator-color=\"transparent\"\r\n                  animated\r\n                  swipeable\r\n                  vertical\r\n                  transition-prev=\"jump-up\"\r\n                  transition-next=\"jump-up\"\r\n                >\r\n                  <q-tab-panel name=\"chats\">\r\n                    <q-list\r\n                      style=\"margin-left: -15px\"\r\n                      v-for=\"(grp, idx) in GroupList\"\r\n                      :key=\"idx\"\r\n                    >\r\n                      <q-item\r\n                        style=\"margin-left: -15px; margin-right: -15px\"\r\n                        :active=\"grp.GROUP_ID == activeID\"\r\n                        clickable\r\n                        v-ripple\r\n                        active-class=\"GroupActiveClass\"\r\n                        @click=\"QItemClick(grp.GROUP_ID)\"\r\n                      >\r\n                        <q-item-section avatar>\r\n                          <q-avatar>\r\n                            <img :src=\"GroupAvatar(grp.GROUP_ID)\" />\r\n                          </q-avatar>\r\n                        </q-item-section>\r\n                        <q-item-section style=\"margin: -15px\">\r\n                          <Group :GroupName=\"grp.GROUP_NAME\"> </Group>\r\n                        </q-item-section>\r\n                      </q-item>\r\n                      <q-separator\r\n                        v-show=\"!(grp.GROUP_ID == activeID)\"\r\n                        color=\"grey-4\"\r\n                      />\r\n                    </q-list>\r\n                  </q-tab-panel>\r\n\r\n                  <q-tab-panel name=\"friends\">\r\n                    <div class=\"text-h4 q-mb-md\">Alarms</div>\r\n                    <p>N/A</p>\r\n                  </q-tab-panel>\r\n\r\n                  <q-tab-panel name=\"others\">\r\n                    <div class=\"text-h4 q-mb-md\">Movies</div>\r\n                    <p>\r\n                      Lorem ipsum dolor sit, amet consectetur adipisicing elit.\r\n                      Quis praesentium cumque magnam odio iure quidem, quod\r\n                      illum numquam possimus obcaecati commodi minima assumenda\r\n                      consectetur culpa fuga nulla ullam. In, libero. Lorem\r\n                      ipsum dolor sit, amet consectetur adipisicing elit. Quis\r\n                      praesentium cumque magnam odio iure quidem, quod illum\r\n                      numquam possimus obcaecati commodi minima assumenda\r\n                      consectetur culpa fuga nulla ullam. In, libero.\r\n                    </p>\r\n                  </q-tab-panel>\r\n                </q-tab-panels>\r\n              </template>\r\n            </q-splitter>\r\n          </div>\r\n        </q-scroll-area>\r\n\r\n        <q-img\r\n          class=\"absolute-top\"\r\n          src=\"../../assets/userBGR.png\"\r\n          style=\"height: 150px\"\r\n        >\r\n          <div class=\"absolute-bottom bg-transparent\">\r\n            <q-avatar size=\"56px\" class=\"q-mb-sm\">\r\n              <img :src=\"imageFromByte(Avatar)\" />\r\n            </q-avatar>\r\n            <div class=\"text-weight-bold\">Ninh Le</div>\r\n            <div>VANNINH.LE@LUXSHARE-ICT.COM</div>\r\n          </div>\r\n        </q-img>\r\n      </q-drawer>\r\n\r\n      <q-page-container class=\"custom-page-container\">\r\n        <q-page>\r\n          <His></His>\r\n        </q-page>\r\n      </q-page-container>\r\n    </q-layout>\r\n  </div>\r\n</template>\r\n  \r\n  <script>\r\nimport { createCanvas, loadImage } from \"canvas\";\r\nimport { mapGetters } from \"vuex\";\r\nimport His from \"./HistoryBox.vue\";\r\nimport Group from \"./GroupInfo.vue\";\r\nexport default {\r\n  components: {\r\n    His,\r\n    Group,\r\n  },\r\n  computed: {\r\n    ...mapGetters({\r\n      GetUser: \"getUser\",\r\n    }),\r\n  },\r\n  mounted() {\r\n    this.Avatar = sessionStorage.getItem(\"Avatar\");\r\n    this.GetChatGroupList();\r\n  },\r\n  methods: {\r\n    async GroupAvatar(group_id) {\r\n      console.log(group_id);\r\n      const group = this.GroupList.find((item) => item.GROUP_ID === group_id);\r\n      const lsrImg = [];\r\n      group.INFO.EMP_AVATAR.forEach((el, id) => {\r\n        if (id <= 3) {\r\n          lsrImg.push(el.AVATAR);\r\n        } else {\r\n          return;\r\n        }\r\n      });\r\n      this.mergedImageUrl = await this.ImageMerging(lsrImg);\r\n      return undefined;\r\n    },\r\n    async ImageMerging(imgList) {\r\n      if (!imgList || imgList.lenght > 4) {\r\n        return \"#\";\r\n      }\r\n      if (imgList.lenght <= 2) {\r\n        return `data:image/png;base64,${imgList[0]}`;\r\n      }\r\n      const canvasWidth = 1000;\r\n      const canvasHeight = 1000;\r\n\r\n      // Tạo đối tượng canvas với kích thước tương ứng\r\n      let canvas = createCanvas(500, 500);\r\n      let ctx = canvas.getContext(\"2d\");\r\n      var lstSyncIMG = [];\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const promises = [];\r\n\r\n        imgList.forEach((task) => {\r\n          const promise = new Promise((innerResolve, innerReject) => {\r\n            try {\r\n              loadImage(`data:image/png;base64,${task}`)\r\n                .then((res) => {\r\n                  ctx.drawImage(res, 0, 0, 500, 500);\r\n                  loadImage(canvas.toDataURL(\"image/png\"))\r\n                    .then((img) => {\r\n                      lstSyncIMG.push(img);\r\n                      innerResolve(img);\r\n                    })\r\n                    .catch((er) => innerReject(er));\r\n                })\r\n                .catch((err) => innerReject(err));\r\n            } catch (error) {\r\n              innerReject(error);\r\n            }\r\n          });\r\n\r\n          promises.push(promise);\r\n        });\r\n\r\n        Promise.all(promises)\r\n          .then(() => {\r\n            canvas = createCanvas(canvasWidth, canvasHeight);\r\n            ctx = canvas.getContext(\"2d\");\r\n\r\n            lstSyncIMG.forEach((el, idx) => {\r\n              switch (idx) {\r\n                case 0:\r\n                  ctx.drawImage(el, 0, 0, 500, 500);\r\n                  break;\r\n                case 1:\r\n                  ctx.drawImage(el, 500, 0, 500, 500);\r\n                  break;\r\n                case 2:\r\n                  ctx.drawImage(el, 0, 500, 500, 500);\r\n                  break;\r\n                case 3:\r\n                  ctx.drawImage(el, 500, 500, 500, 500);\r\n                  break;\r\n                default:\r\n                  break;\r\n              }\r\n            });\r\n\r\n            resolve(canvas.toDataURL(\"image/png\"));\r\n          })\r\n          .catch((error) => {\r\n            reject(error);\r\n          });\r\n      });\r\n    },\r\n    QItemClick(id) {\r\n      this.activeID = id;\r\n    },\r\n    GetChatGroupList() {\r\n      this.axios\r\n        .get(`api/chatapp/GetEmpAllGroup?emp_id=${this.GetUser.EMP_ID}`)\r\n        .then((res) => {\r\n          this.GroupList = res.data;\r\n        })\r\n        .catch((err) => {\r\n          console.log(err);\r\n        });\r\n    },\r\n    imageFromByte(strBase64) {\r\n      return `data:image/jpeg;base64,${strBase64}`;\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      tab: \"chats\",\r\n      splitterModel: 20,\r\n      Avatar: \"\",\r\n      drawer: false,\r\n      activeID: 0,\r\n      GroupName: \"Test-Group\",\r\n      GroupList: [{ GROUP_ID: 0, GROUP_NAME: \"Default\" }],\r\n    };\r\n  },\r\n};\r\n</script>\r\n<style scoped>\r\n.custom-page-container {\r\n  background-color: #1f144b;\r\n}\r\n.GroupActiveClass {\r\n  background-color: aquamarine;\r\n}\r\n</style>\r\n  "],"mappings":";AAmIA,SAASA,YAAY,EAAEC,SAAQ,QAAS,QAAQ;AAChD,SAASC,UAAS,QAAS,MAAM;AACjC,OAAOC,GAAE,MAAO,kBAAkB;AAClC,OAAOC,KAAI,MAAO,iBAAiB;AACnC,eAAe;EACbC,UAAU,EAAE;IACVF,GAAG;IACHC;EACF,CAAC;EACDE,QAAQ,EAAE;IACR,GAAGJ,UAAU,CAAC;MACZK,OAAO,EAAE;IACX,CAAC;EACH,CAAC;EACDC,OAAOA,CAAA,EAAG;IACR,IAAI,CAACC,MAAK,GAAIC,cAAc,CAACC,OAAO,CAAC,QAAQ,CAAC;IAC9C,IAAI,CAACC,gBAAgB,EAAE;EACzB,CAAC;EACDC,OAAO,EAAE;IACP,MAAMC,WAAWA,CAACC,QAAQ,EAAE;MAC1BC,OAAO,CAACC,GAAG,CAACF,QAAQ,CAAC;MACrB,MAAMG,KAAI,GAAI,IAAI,CAACC,SAAS,CAACC,IAAI,CAAEC,IAAI,IAAKA,IAAI,CAACC,QAAO,KAAMP,QAAQ,CAAC;MACvE,MAAMQ,MAAK,GAAI,EAAE;MACjBL,KAAK,CAACM,IAAI,CAACC,UAAU,CAACC,OAAO,CAAC,CAACC,EAAE,EAAEC,EAAE,KAAK;QACxC,IAAIA,EAAC,IAAK,CAAC,EAAE;UACXL,MAAM,CAACM,IAAI,CAACF,EAAE,CAACG,MAAM,CAAC;QACxB,OAAO;UACL;QACF;MACF,CAAC,CAAC;MACF,IAAI,CAACC,cAAa,GAAI,MAAM,IAAI,CAACC,YAAY,CAACT,MAAM,CAAC;MACrD,OAAOU,SAAS;IAClB,CAAC;IACD,MAAMD,YAAYA,CAACE,OAAO,EAAE;MAC1B,IAAI,CAACA,OAAM,IAAKA,OAAO,CAACC,MAAK,GAAI,CAAC,EAAE;QAClC,OAAO,GAAG;MACZ;MACA,IAAID,OAAO,CAACC,MAAK,IAAK,CAAC,EAAE;QACvB,OAAQ,yBAAwBD,OAAO,CAAC,CAAC,CAAE,EAAC;MAC9C;MACA,MAAME,WAAU,GAAI,IAAI;MACxB,MAAMC,YAAW,GAAI,IAAI;;MAEzB;MACA,IAAIC,MAAK,GAAItC,YAAY,CAAC,GAAG,EAAE,GAAG,CAAC;MACnC,IAAIuC,GAAE,GAAID,MAAM,CAACE,UAAU,CAAC,IAAI,CAAC;MACjC,IAAIC,UAAS,GAAI,EAAE;MAEnB,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;QACtC,MAAMC,QAAO,GAAI,EAAE;QAEnBX,OAAO,CAACR,OAAO,CAAEoB,IAAI,IAAK;UACxB,MAAMC,OAAM,GAAI,IAAIL,OAAO,CAAC,CAACM,YAAY,EAAEC,WAAW,KAAK;YACzD,IAAI;cACFhD,SAAS,CAAE,yBAAwB6C,IAAK,EAAC,EACtCI,IAAI,CAAEC,GAAG,IAAK;gBACbZ,GAAG,CAACa,SAAS,CAACD,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC;gBAClClD,SAAS,CAACqC,MAAM,CAACe,SAAS,CAAC,WAAW,CAAC,EACpCH,IAAI,CAAEI,GAAG,IAAK;kBACbb,UAAU,CAACZ,IAAI,CAACyB,GAAG,CAAC;kBACpBN,YAAY,CAACM,GAAG,CAAC;gBACnB,CAAC,EACAC,KAAK,CAAEC,EAAE,IAAKP,WAAW,CAACO,EAAE,CAAC,CAAC;cACnC,CAAC,EACAD,KAAK,CAAEE,GAAG,IAAKR,WAAW,CAACQ,GAAG,CAAC,CAAC;YACrC,EAAE,OAAOC,KAAK,EAAE;cACdT,WAAW,CAACS,KAAK,CAAC;YACpB;UACF,CAAC,CAAC;UAEFb,QAAQ,CAAChB,IAAI,CAACkB,OAAO,CAAC;QACxB,CAAC,CAAC;QAEFL,OAAO,CAACiB,GAAG,CAACd,QAAQ,EACjBK,IAAI,CAAC,MAAM;UACVZ,MAAK,GAAItC,YAAY,CAACoC,WAAW,EAAEC,YAAY,CAAC;UAChDE,GAAE,GAAID,MAAM,CAACE,UAAU,CAAC,IAAI,CAAC;UAE7BC,UAAU,CAACf,OAAO,CAAC,CAACC,EAAE,EAAEiC,GAAG,KAAK;YAC9B,QAAQA,GAAG;cACT,KAAK,CAAC;gBACJrB,GAAG,CAACa,SAAS,CAACzB,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC;gBACjC;cACF,KAAK,CAAC;gBACJY,GAAG,CAACa,SAAS,CAACzB,EAAE,EAAE,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC;gBACnC;cACF,KAAK,CAAC;gBACJY,GAAG,CAACa,SAAS,CAACzB,EAAE,EAAE,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;gBACnC;cACF,KAAK,CAAC;gBACJY,GAAG,CAACa,SAAS,CAACzB,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;gBACrC;cACF;gBACE;YAAK;UAEX,CAAC,CAAC;UAEFgB,OAAO,CAACL,MAAM,CAACe,SAAS,CAAC,WAAW,CAAC,CAAC;QACxC,CAAC,EACAE,KAAK,CAAEG,KAAK,IAAK;UAChBd,MAAM,CAACc,KAAK,CAAC;QACf,CAAC,CAAC;MACN,CAAC,CAAC;IACJ,CAAC;IACDG,UAAUA,CAACjC,EAAE,EAAE;MACb,IAAI,CAACkC,QAAO,GAAIlC,EAAE;IACpB,CAAC;IACDhB,gBAAgBA,CAAA,EAAG;MACjB,IAAI,CAACmD,KAAI,CACNC,GAAG,CAAE,qCAAoC,IAAI,CAACzD,OAAO,CAAC0D,MAAO,EAAC,EAC9Df,IAAI,CAAEC,GAAG,IAAK;QACb,IAAI,CAAChC,SAAQ,GAAIgC,GAAG,CAACe,IAAI;MAC3B,CAAC,EACAX,KAAK,CAAEE,GAAG,IAAK;QACdzC,OAAO,CAACC,GAAG,CAACwC,GAAG,CAAC;MAClB,CAAC,CAAC;IACN,CAAC;IACDU,aAAaA,CAACC,SAAS,EAAE;MACvB,OAAQ,0BAAyBA,SAAU,EAAC;IAC9C;EACF,CAAC;EACDF,IAAIA,CAAA,EAAG;IACL,OAAO;MACLG,GAAG,EAAE,OAAO;MACZC,aAAa,EAAE,EAAE;MACjB7D,MAAM,EAAE,EAAE;MACV8D,MAAM,EAAE,KAAK;MACbT,QAAQ,EAAE,CAAC;MACXU,SAAS,EAAE,YAAY;MACvBrD,SAAS,EAAE,CAAC;QAAEG,QAAQ,EAAE,CAAC;QAAEmD,UAAU,EAAE;MAAU,CAAC;IACpD,CAAC;EACH;AACF,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}